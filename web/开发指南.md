# AI教师 Web端 - 开发指南

## 快速开始

### 1. 安装依赖

```bash
cd web
npm install
```

### 2. 启动开发服务器

```bash
npm run dev
```

访问 http://localhost:3000

### 3. 构建生产版本

```bash
npm run build
```

### 4. 预览生产构建

```bash
npm run preview
```

## 项目结构说明

```
web/
├── public/                 # 静态资源
│   └── logo.svg           # 网站Logo
├── src/
│   ├── api/               # API接口封装
│   │   ├── auth.ts        # 认证相关接口
│   │   ├── user.ts        # 用户相关接口
│   │   ├── conversation.ts # 对话相关接口
│   │   ├── file.ts        # 文件相关接口
│   │   └── textbook.ts    # 教材相关接口
│   ├── assets/            # 资源文件
│   ├── components/        # 通用组件
│   │   ├── FileUpload.vue # 文件上传组件
│   │   ├── MessageItem.vue # 消息展示组件
│   │   └── QuestionInput.vue # 问题输入组件
│   ├── layouts/           # 布局组件
│   │   └── MainLayout.vue # 主布局
│   ├── router/            # 路由配置
│   │   └── index.ts       # 路由定义
│   ├── stores/            # 状态管理（Pinia）
│   │   ├── app.ts         # 应用状态
│   │   ├── user.ts        # 用户状态
│   │   └── conversation.ts # 对话状态
│   ├── styles/            # 全局样式
│   │   └── index.scss     # 主样式文件
│   ├── types/             # TypeScript类型定义
│   │   └── index.ts       # 类型定义
│   ├── utils/             # 工具函数
│   │   ├── request.ts     # HTTP请求封装
│   │   ├── constants.ts   # 常量定义
│   │   ├── format.ts      # 格式化函数
│   │   ├── markdown.ts    # Markdown渲染
│   │   └── storage.ts     # 本地存储
│   ├── views/             # 页面组件
│   │   ├── Login.vue      # 登录页
│   │   ├── Chat.vue       # 对话页
│   │   ├── History.vue    # 历史记录页
│   │   ├── Profile.vue    # 个人中心页
│   │   └── NotFound.vue   # 404页面
│   ├── App.vue            # 根组件
│   └── main.ts            # 入口文件
├── index.html             # HTML模板
├── package.json           # 项目配置
├── tsconfig.json          # TypeScript配置
├── vite.config.ts         # Vite配置
└── README.md              # 项目说明
```

## 核心功能说明

### 1. 登录功能（Login.vue）

**扫码登录流程：**
1. 页面加载时调用 `generateQrCode()` 生成二维码
2. 展示二维码图片供用户扫描
3. 每2秒轮询一次 `getQrCodeStatus()` 检查登录状态
4. 用户在小程序端确认后，状态变为 CONFIRMED
5. 获取token和用户信息，保存到Store
6. 跳转到主页

**关键代码：**
```typescript
// 生成二维码
const initQrCode = async () => {
  const data = await generateQrCode()
  qrcodeUrl.value = data.qrcodeUrl
  ticket.value = data.ticket
  startPolling()
}

// 轮询登录状态
const startPolling = () => {
  pollingTimer = setInterval(async () => {
    const data = await getQrCodeStatus(ticket.value)
    if (data.status === QrCodeStatus.CONFIRMED) {
      userStore.login(data.token, data.userInfo)
      router.push('/')
    }
  }, 2000)
}
```

### 2. 对话功能（Chat.vue）

**对话流程：**
1. 用户选择省份、年级、学科
2. 点击"开始对话"创建新会话
3. 输入问题，支持文本、图片、文件
4. 发送消息到后端
5. 实时展示AI回答（支持流式输出）
6. 支持多轮对话

**关键特性：**
- 多模态输入（文本、图片、文件）
- AI模型选择（通义千问、腾讯元宝等）
- Markdown + LaTeX公式渲染
- 自动滚动到最新消息
- 对话历史保存

### 3. 历史记录（History.vue）

**功能：**
- 展示所有历史对话
- 支持按学科筛选
- 支持收藏对话
- 支持删除对话
- 点击进入对话详情

### 4. 个人中心（Profile.vue）

**功能：**
- 修改个人信息（昵称、手机号、省份、年级）
- 切换深色模式
- 查看使用统计
- 退出登录

## 技术要点

### 1. 状态管理（Pinia）

**用户状态（stores/user.ts）：**
```typescript
export const useUserStore = defineStore('user', () => {
  const token = ref('')
  const userInfo = ref(null)
  
  const login = (newToken, info) => {
    token.value = newToken
    userInfo.value = info
  }
  
  const logout = async () => {
    // 清空状态
  }
  
  return { token, userInfo, login, logout }
}, { persist: true }) // 持久化
```

**对话状态（stores/conversation.ts）：**
- 管理当前对话
- 管理消息列表
- 提供对话相关操作方法

### 2. API封装（utils/request.ts）

**统一请求封装：**
```typescript
// 请求拦截器：添加token
service.interceptors.request.use((config) => {
  const userStore = useUserStore()
  if (userStore.token) {
    config.headers.Authorization = `Bearer ${userStore.token}`
  }
  return config
})

// 响应拦截器：统一错误处理
service.interceptors.response.use(
  (response) => response.data,
  (error) => {
    if (error.response?.status === 401) {
      // 未授权，跳转登录
      router.push('/login')
    }
    return Promise.reject(error)
  }
)
```

### 3. 路由守卫（router/index.ts）

```typescript
router.beforeEach((to, from, next) => {
  const userStore = useUserStore()
  
  // 检查是否需要登录
  if (to.meta.requiresAuth && !userStore.token) {
    next('/login')
  } else {
    next()
  }
})
```

### 4. Markdown渲染（utils/markdown.ts）

**支持特性：**
- 基础Markdown语法
- 代码高亮（highlight.js）
- LaTeX数学公式（KaTeX）
- 行内公式：`$公式$`
- 块级公式：`$$公式$$`

### 5. 组件通信

**父子组件通信：**
```vue
<!-- 父组件 -->
<QuestionInput @send="handleSendMessage" />

<!-- 子组件 -->
<script setup>
const emit = defineEmits(['send'])
const handleSend = () => {
  emit('send', { content, files, aiModel })
}
</script>
```

## 开发规范

### 1. 命名规范

- **组件文件**：PascalCase（如 `MessageItem.vue`）
- **工具函数**：camelCase（如 `formatDateTime`）
- **常量**：UPPER_SNAKE_CASE（如 `AI_MODELS`）
- **类型定义**：PascalCase（如 `UserInfo`）

### 2. 样式规范

- 使用 SCSS 预处理器
- 支持深色模式（`.dark` 类）
- 响应式设计（使用媒体查询）
- 统一间距、颜色、字体大小

### 3. Git提交规范

```
feat: 新功能
fix: 修复bug
docs: 文档更新
style: 代码格式调整
refactor: 重构
perf: 性能优化
test: 测试相关
chore: 构建/工具链相关
```

## 常见问题

### 1. API请求失败

**检查项：**
- 后端服务是否启动
- API地址是否正确（vite.config.ts中的proxy配置）
- token是否有效
- 网络连接是否正常

### 2. 样式不生效

**检查项：**
- SCSS语法是否正确
- 是否正确引入全局样式
- Element Plus主题是否正确加载
- 深色模式类名是否正确

### 3. 路由跳转失败

**检查项：**
- 路由路径是否正确
- 是否通过路由守卫
- token是否存在

## 后续优化建议

### 1. 性能优化
- [ ] 组件懒加载
- [ ] 图片懒加载
- [ ] 虚拟滚动（长列表）
- [ ] 请求缓存
- [ ] 防抖节流

### 2. 功能增强
- [ ] 语音输入
- [ ] 导出对话记录
- [ ] 分享对话
- [ ] 搜索功能
- [ ] 多语言支持

### 3. 用户体验
- [ ] 骨架屏加载
- [ ] 加载动画优化
- [ ] 错误提示优化
- [ ] 快捷键支持
- [ ] PWA支持

### 4. 测试
- [ ] 单元测试
- [ ] E2E测试
- [ ] 可访问性测试

## 联系方式

如有问题，请联系开发团队。

